        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>TransformGraph class / spectre_scene Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="spectre_scene" data-type="TransformGraph">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../spectre_scene.html">spectre_scene</a> &rsaquo; <a href="../spectre_scene/TransformGraph.html">TransformGraph</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>TransformGraph</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<pre class="source">
class TransformGraph {
 List&lt;TransformGraphNode&gt; _nodes;
 List&lt;TransformGraphNode&gt; _sortedNodes;

 TransformGraph() {
   _nodes = new List&lt;TransformGraphNode&gt;();
   _sortedNodes = new List&lt;TransformGraphNode&gt;();
 }

 /// Create a new transform node. The node has no parent and is the identity.
 TransformGraphNode createNode() {
   TransformGraphNode node = new TransformGraphNode._internal();
   _nodes.add(node);
   return node;
 }

 void _unparentChildren(TransformGraphNode parent) {
   for (int i = 0; i &lt; _nodes.length; i++) {
     if (_nodes[i].parent == parent) {
       unparent(_nodes[i]);
     }
   }
 }

 void _swapAndPop(int index) {
   // Move end of list into index we are removing.
   TransformGraphNode last = _nodes.last;
   _nodes[index] = last;
   // Remove last node.
   _nodes.removeLast();
 }

 /// Delete an existing transform node [node]
 void deleteNode(TransformGraphNode node) {
   if (node == null) {
     return;
   }
   int index = _nodes.indexOf(node, 0);
   assert(index &gt;= 0);
   _swapAndPop(index);
 }

 /// Make [node] a leaf node
 void unparent(TransformGraphNode node) {
   TransformGraphNode parent = node.parent;
   // Cleanup parent
   if (parent == null) {
     return;
   }
   parent.childCount--;
   assert(parent.childCount &gt;= 0);
 }

 /// Make [node] a child of [parent]
 void reparent(TransformGraphNode node, TransformGraphNode parent) {
   if (node == null) {
     return;
   }
   // Unparent
   unparent(node);
   if (parent == null) {
     return;
   }
   node.parent = parent;
   parent.childCount++;
 }

 /// Must be called after modifying the transform graph
 void updateGraph() {
   // Find leafs
   Queue&lt;TransformGraphNode&gt; leafs = new Queue&lt;TransformGraphNode&gt;();
   for (int i = 0; i &lt; _nodes.length; i++) {
     _nodes[i].childCountSort = _nodes[i].childCount;
     if (_nodes[i].childCount == 0) {
       leafs.add(_nodes[i]);
     }
   }
   while (leafs.length &gt; 0) {
     TransformGraphNode leaf = leafs.removeLast();
     _sortedNodes.add(leaf);
     if (leaf.parent != null) {
       leaf.parent.childCountSort--;
       if (leaf.parent.childCountSort == 0) {
         leafs.add(leaf.parent);
       }
     }
   }
 }

 /// Get a reference to the world transform for [node]
 mat4 refWorldMatrix(TransformGraphNode node) {
   if (node == null) {
     return null;
   }
   return node.worldTransform;
 }

 Float32Array refWorldMatrixArray(TransformGraphNode node) {
   if (node == null) {
     return null;
   }
   return node.worldTransformArray;
 }

 /// Set the local transform for [node]
 void setLocalMatrix(TransformGraphNode node, mat4 m) {
   if (node == null) {
     return null;
   }
   node.localTransform.copyFrom(m);
 }

 /// Get a reference to the local transform for [node]
 mat4 refLocalMatrix(TransformGraphNode node) {
   if (node == null) {
     return null;
   }
   return node.localTransform;
 }

 /// Updates the world transformation matrices for all nodes in the graph
 void updateWorldMatrices() {
   for (int i = _sortedNodes.length-1; i &gt;= 0 ; i--) {
     TransformGraphNode node = _sortedNodes[i];
     if (node.parent != null) {
       node.worldTransform.copyFrom(node.parent.worldTransform);
       node.worldTransform.multiply(node.localTransform);
     } else {
       node.worldTransform.copyFrom(node.localTransform);
     }
     node.worldTransform.copyIntoArray(node.worldTransformArray, 0);
   }
 }
}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="TransformGraph">
<button class="show-code">Code</button>
new <strong>TransformGraph</strong>() <a class="anchor-link" href="#TransformGraph"
              title="Permalink to TransformGraph.TransformGraph">#</a></h4>
<div class="doc">
<pre class="source">
TransformGraph() {
 _nodes = new List&lt;TransformGraphNode&gt;();
 _sortedNodes = new List&lt;TransformGraphNode&gt;();
}
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="createNode">
<button class="show-code">Code</button>
<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> <strong>createNode</strong>() <a class="anchor-link" href="#createNode"
              title="Permalink to TransformGraph.createNode">#</a></h4>
<div class="doc">
<p>Create a new transform node. The node has no parent and is the identity.</p>
<pre class="source">
TransformGraphNode createNode() {
 TransformGraphNode node = new TransformGraphNode._internal();
 _nodes.add(node);
 return node;
}
</pre>
</div>
</div>
<div class="method"><h4 id="deleteNode">
<button class="show-code">Code</button>
void <strong>deleteNode</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node) <a class="anchor-link" href="#deleteNode"
              title="Permalink to TransformGraph.deleteNode">#</a></h4>
<div class="doc">
<p>Delete an existing transform node 
<span class="param">node</span></p>
<pre class="source">
void deleteNode(TransformGraphNode node) {
 if (node == null) {
   return;
 }
 int index = _nodes.indexOf(node, 0);
 assert(index &gt;= 0);
 _swapAndPop(index);
}
</pre>
</div>
</div>
<div class="method"><h4 id="refLocalMatrix">
<button class="show-code">Code</button>
<a href="../vector_math_browser/mat4.html">mat4</a> <strong>refLocalMatrix</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node) <a class="anchor-link" href="#refLocalMatrix"
              title="Permalink to TransformGraph.refLocalMatrix">#</a></h4>
<div class="doc">
<p>Get a reference to the local transform for 
<span class="param">node</span></p>
<pre class="source">
mat4 refLocalMatrix(TransformGraphNode node) {
 if (node == null) {
   return null;
 }
 return node.localTransform;
}
</pre>
</div>
</div>
<div class="method"><h4 id="refWorldMatrix">
<button class="show-code">Code</button>
<a href="../vector_math_browser/mat4.html">mat4</a> <strong>refWorldMatrix</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node) <a class="anchor-link" href="#refWorldMatrix"
              title="Permalink to TransformGraph.refWorldMatrix">#</a></h4>
<div class="doc">
<p>Get a reference to the world transform for 
<span class="param">node</span></p>
<pre class="source">
mat4 refWorldMatrix(TransformGraphNode node) {
 if (node == null) {
   return null;
 }
 return node.worldTransform;
}
</pre>
</div>
</div>
<div class="method"><h4 id="refWorldMatrixArray">
<button class="show-code">Code</button>
Float32Array <strong>refWorldMatrixArray</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node) <a class="anchor-link" href="#refWorldMatrixArray"
              title="Permalink to TransformGraph.refWorldMatrixArray">#</a></h4>
<div class="doc">
<pre class="source">
Float32Array refWorldMatrixArray(TransformGraphNode node) {
 if (node == null) {
   return null;
 }
 return node.worldTransformArray;
}
</pre>
</div>
</div>
<div class="method"><h4 id="reparent">
<button class="show-code">Code</button>
void <strong>reparent</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node, <a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> parent) <a class="anchor-link" href="#reparent"
              title="Permalink to TransformGraph.reparent">#</a></h4>
<div class="doc">
<p>Make 
<span class="param">node</span> a child of 
<span class="param">parent</span></p>
<pre class="source">
void reparent(TransformGraphNode node, TransformGraphNode parent) {
 if (node == null) {
   return;
 }
 // Unparent
 unparent(node);
 if (parent == null) {
   return;
 }
 node.parent = parent;
 parent.childCount++;
}
</pre>
</div>
</div>
<div class="method"><h4 id="setLocalMatrix">
<button class="show-code">Code</button>
void <strong>setLocalMatrix</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node, <a href="../vector_math_browser/mat4.html">mat4</a> m) <a class="anchor-link" href="#setLocalMatrix"
              title="Permalink to TransformGraph.setLocalMatrix">#</a></h4>
<div class="doc">
<p>Set the local transform for 
<span class="param">node</span></p>
<pre class="source">
void setLocalMatrix(TransformGraphNode node, mat4 m) {
 if (node == null) {
   return null;
 }
 node.localTransform.copyFrom(m);
}
</pre>
</div>
</div>
<div class="method"><h4 id="unparent">
<button class="show-code">Code</button>
void <strong>unparent</strong>(<a href="../spectre_scene/TransformGraphNode.html">TransformGraphNode</a> node) <a class="anchor-link" href="#unparent"
              title="Permalink to TransformGraph.unparent">#</a></h4>
<div class="doc">
<p>Make 
<span class="param">node</span> a leaf node</p>
<pre class="source">
void unparent(TransformGraphNode node) {
 TransformGraphNode parent = node.parent;
 // Cleanup parent
 if (parent == null) {
   return;
 }
 parent.childCount--;
 assert(parent.childCount &gt;= 0);
}
</pre>
</div>
</div>
<div class="method"><h4 id="updateGraph">
<button class="show-code">Code</button>
void <strong>updateGraph</strong>() <a class="anchor-link" href="#updateGraph"
              title="Permalink to TransformGraph.updateGraph">#</a></h4>
<div class="doc">
<p>Must be called after modifying the transform graph</p>
<pre class="source">
void updateGraph() {
 // Find leafs
 Queue&lt;TransformGraphNode&gt; leafs = new Queue&lt;TransformGraphNode&gt;();
 for (int i = 0; i &lt; _nodes.length; i++) {
   _nodes[i].childCountSort = _nodes[i].childCount;
   if (_nodes[i].childCount == 0) {
     leafs.add(_nodes[i]);
   }
 }
 while (leafs.length &gt; 0) {
   TransformGraphNode leaf = leafs.removeLast();
   _sortedNodes.add(leaf);
   if (leaf.parent != null) {
     leaf.parent.childCountSort--;
     if (leaf.parent.childCountSort == 0) {
       leafs.add(leaf.parent);
     }
   }
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="updateWorldMatrices">
<button class="show-code">Code</button>
void <strong>updateWorldMatrices</strong>() <a class="anchor-link" href="#updateWorldMatrices"
              title="Permalink to TransformGraph.updateWorldMatrices">#</a></h4>
<div class="doc">
<p>Updates the world transformation matrices for all nodes in the graph</p>
<pre class="source">
void updateWorldMatrices() {
 for (int i = _sortedNodes.length-1; i &gt;= 0 ; i--) {
   TransformGraphNode node = _sortedNodes[i];
   if (node.parent != null) {
     node.worldTransform.copyFrom(node.parent.worldTransform);
     node.worldTransform.multiply(node.localTransform);
   } else {
     node.worldTransform.copyFrom(node.localTransform);
   }
   node.worldTransform.copyIntoArray(node.worldTransformArray, 0);
 }
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
